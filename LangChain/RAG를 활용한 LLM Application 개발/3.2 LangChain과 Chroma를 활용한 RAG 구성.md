# LangChain과 Chroma를 활용한 RAG 구성
- RAG를 위한 문서 생성 노하우
  - 문서를 읽는다
  - 문서를 쪼갠다
    - 토큰 수 초과로 답변 생성 못할 수 있음
    - 문서가 길면 답변 생성이 오래 걸림
  - 임베딩 -> 벡터 데이터베이스에 저장
  - 질문이 있을 때 벡터 데이터베이스에 유사도 검색
  - 유사도 검색으로 가져온 문서를 LLM에 질문과 함께 전달

## text splitter
- 보통 `RecursiveCharacterSplitter` 혹은 `CharacterTextSplitter`를 많이 사용
  - `CharacterTextSplitter`는 `\n\n`를 구분자로 사용
  - `RecursiveCharacterSplitter`는 list로 구분자롤 주어 사용 가능
    - 예: ["\n\n", "\n", " ", ""]

## 벡터 유사도
- Euclidean
  - 4분면에서 두 벡터 점 사이의 거리를 측정, 가까울수록 유사
- Dot Product
  - 두 벡터의 각 인자끼리 곱하고 더한 값이 클수록 유사
    - king = [1, 2, 3, 4, 5]
    - queen = [3, 4, 1, 2, 5]
    - dot_prodict = king[0] * queen[0] + king[1] * queen[1] + ... + king[4] * queen[4]
    - 벡터의 차원이 커질 수록 절대 숫자가 커지기에 유의 필요
- Cosine
  - 두 벡터 사이의 각도가 작을 수록 유사
- 무엇이 가장 좋다는 없지만, 통상적으로 코사인을 주로 사용
- 가장 성능이 좋은 알고리즘 테스트가 필요

## Retriever 효율 개선
- 만약 `연봉 5천만원인 직장인의 소득세는?`이라는 query가 있을 때 검색 결과로 과세 표준에 대한 표가 후순위로 나오거나 나오지 않을 경우
  - 과세 표준에 대한 표 정보에는 `거주자의 종합소득에 대한 소득세...(생략)`라고 할 때
  - `거주자`와 `직장인`이라는 단어가 벡터 DB상에서 관련도가 높지 않다는 뜻
  - 러프하게 따져봤을 때 직장인은 회사에서 일을 하는 사람, 거주자는 집에 사는 사람이기에 연관도가 없는 것이 맞음